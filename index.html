<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Monitoring Stok - WHS DDD</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap');
        
        :root {
            --zuma-dark: #002A3A;
            --zuma-green: #00E273;
            --zuma-dark-light: #003d52;
            --zuma-green-light: #33e88f;
            --zuma-green-dark: #00c264;
        }
        
        body { 
            font-family: 'Inter', sans-serif; 
            background-color: #f0f5f7;
        }
        
        /* Gradient dengan warna ZUMA */
        .gradient-zuma { background: linear-gradient(135deg, var(--zuma-dark) 0%, var(--zuma-dark-light) 100%); }
        .gradient-zuma-green { background: linear-gradient(135deg, var(--zuma-green) 0%, var(--zuma-green-light) 100%); }
        .gradient-zuma-mixed { background: linear-gradient(135deg, var(--zuma-dark) 0%, var(--zuma-green) 100%); }
        
        /* Header dengan warna ZUMA */
        .zuma-header {
            background: var(--zuma-dark);
        }
        
        /* Button style ZUMA */
        .btn-zuma {
            background: var(--zuma-green);
            color: var(--zuma-dark);
        }
        .btn-zuma:hover {
            background: var(--zuma-green-dark);
        }
        
        /* Card accent */
        .card-accent-top {
            border-top: 4px solid var(--zuma-green);
        }
        
        /* Scrollbar custom */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #e5e7eb;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb {
            background: var(--zuma-green);
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: var(--zuma-green-dark);
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">
    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50" style="display: none;">
        <div class="bg-white rounded-xl p-8 flex flex-col items-center gap-4 shadow-2xl">
            <div class="animate-spin rounded-full h-12 w-12 border-4 border-gray-200" style="border-top-color: #00E273;"></div>
            <p class="text-gray-700 font-medium">Memuat data dari Google Sheets...</p>
        </div>
    </div>
    
    <!-- Header -->
    <header class="zuma-header shadow-lg">
        <div class="max-w-7xl mx-auto px-4 py-4 flex justify-between items-center">
            <div class="flex items-center gap-4">
                <!-- ZUMA Logo - Accurate logogram based on brand guidelines -->
                <div class="flex items-center gap-3">
                    <div class="w-12 h-12 rounded-lg flex items-center justify-center" style="background: #00E273;">
                        <svg width="30" height="30" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <!-- ZUMA Logogram - Stylized flowing Z -->
                            <path d="M15 22 L40 22 Q50 22, 45 32 L25 58 Q20 66, 28 66 L85 66 L85 78 L28 78 Q8 78, 18 62 L42 32 Q48 22, 38 10 L15 10 Z" fill="#002A3A"/>
                        </svg>
                    </div>
                    <div>
                        <h1 class="text-2xl font-extrabold text-white flex items-center gap-2">
                            <span style="color: #00E273;">ZUMA</span> 
                            <span class="font-normal text-gray-300">|</span>
                            <span class="font-semibold text-lg">Dashboard</span>
                        </h1>
                        <p class="text-sm text-gray-400">WHS DDD - Monitoring Stok Real-time</p>
                    </div>
                </div>
            </div>
            <div class="flex items-center gap-4">
                <span id="lastUpdate" class="text-sm text-gray-400"></span>
                <button onclick="refreshData()" class="btn-zuma px-4 py-2 rounded-lg font-semibold flex items-center gap-2 transition-all hover:scale-105">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                    </svg>
                    Refresh
                </button>
            </div>
        </div>
        
        <!-- Main Navigation Tabs -->
        <div class="max-w-7xl mx-auto px-4">
            <nav class="flex gap-1 pt-2">
                <button onclick="switchMainTab('stock')" id="mainTabStock" 
                    class="px-5 py-2.5 rounded-t-lg font-semibold text-sm transition-all bg-gray-100 text-gray-800 border-t-2 border-x-2 border-gray-200" 
                    style="margin-bottom: -1px; position: relative; z-index: 10;">
                    üì¶ Stock Monitoring
                </button>
                <button onclick="switchMainTab('igrm')" id="mainTabIGRM" 
                    class="px-5 py-2.5 rounded-t-lg font-semibold text-sm transition-all text-gray-400 hover:text-gray-600 hover:bg-gray-50">
                    üè≠ Monitoring IG & RM
                </button>
            </nav>
        </div>
    </header>

    <!-- Modal Popup untuk Detail Tier -->
    <div id="tierModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50 p-4">
        <div class="bg-white rounded-2xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-hidden">
            <!-- Modal Header -->
            <div id="modalHeader" class="px-6 py-4 border-b flex justify-between items-center">
                <div>
                    <h3 id="modalTitle" class="text-xl font-bold text-gray-800">Detail Tier 1</h3>
                    <p id="modalSubtitle" class="text-sm text-gray-500 mt-1">Total: 2,007 Box | 24,084 Pairs | 201 Artikel</p>
                </div>
                <button onclick="closeModal()" class="p-2 hover:bg-gray-100 rounded-full transition-colors">
                    <svg class="w-6 h-6 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Modal Body -->
            <div class="px-6 py-4 overflow-y-auto max-h-[60vh]">
                <!-- Summary Cards in Modal -->
                <div class="grid grid-cols-3 gap-4 mb-4">
                    <div id="modalBoxCard" class="bg-blue-50 rounded-lg p-4 text-center">
                        <p class="text-2xl font-bold text-blue-600">2,007</p>
                        <p class="text-sm text-blue-500">Total Box</p>
                    </div>
                    <div id="modalPairsCard" class="bg-green-50 rounded-lg p-4 text-center">
                        <p class="text-2xl font-bold text-green-600">24,084</p>
                        <p class="text-sm text-green-500">Total Pairs</p>
                    </div>
                    <div id="modalArtikelCard" class="bg-purple-50 rounded-lg p-4 text-center">
                        <p class="text-2xl font-bold text-purple-600">201</p>
                        <p class="text-sm text-purple-500">Jumlah Artikel</p>
                    </div>
                </div>

                <!-- Search in Modal -->
                <div class="mb-4">
                    <input type="text" id="modalSearch" placeholder="Cari artikel dalam tier ini..." 
                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                        onkeyup="filterModalTable()">
                </div>

                <!-- Filter Buttons -->
                <div class="mb-4 flex gap-2">
                    <button id="filterAll" onclick="setModalFilter('all')" 
                        class="px-4 py-2 text-sm font-medium rounded-lg transition-colors text-white"
                        style="background: #002A3A;">
                        üì¶ Semua
                    </button>
                    <button id="filterHasStock" onclick="setModalFilter('hasStock')" 
                        class="px-4 py-2 text-sm font-medium rounded-lg transition-colors bg-gray-100 text-gray-700 hover:bg-gray-200">
                        ‚úÖ Ada Stok
                    </button>
                    <button id="filterNoStock" onclick="setModalFilter('noStock')" 
                        class="px-4 py-2 text-sm font-medium rounded-lg transition-colors bg-gray-100 text-gray-700 hover:bg-gray-200">
                        ‚ùå Habis
                    </button>
                </div>

                <!-- Table in Modal -->
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead class="bg-gray-50 sticky top-0">
                            <tr>
                                <th class="text-left py-3 px-4 text-sm font-semibold text-gray-600">No</th>
                                <th class="text-left py-3 px-4 text-sm font-semibold text-gray-600">Kode Artikel</th>
                                <th class="text-left py-3 px-4 text-sm font-semibold text-gray-600">Nama Artikel</th>
                                <th class="text-right py-3 px-4 text-sm font-semibold text-gray-600">Box DDD</th>
                                <th class="text-right py-3 px-4 text-sm font-semibold text-gray-600">Box LJBB</th>
                                <th class="text-right py-3 px-4 text-sm font-semibold text-gray-600">Total Box</th>
                                <th class="text-right py-3 px-4 text-sm font-semibold text-gray-600">Pairs</th>
                                <th class="text-center py-3 px-4 text-sm font-semibold text-gray-600">Status</th>
                            </tr>
                        </thead>
                        <tbody id="modalTableBody">
                            <!-- Data akan diisi oleh JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Modal Footer -->
            <div class="px-6 py-4 border-t bg-gray-50 flex justify-between items-center">
                <span id="modalTableInfo" class="text-sm text-gray-500">Menampilkan 0 artikel</span>
                <button onclick="closeModal()" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors">
                    Tutup
                </button>
            </div>
        </div>
    </div>

    <main class="max-w-7xl mx-auto px-4 py-6">
        <!-- Stock Monitoring Tab Content -->
        <div id="stockTabContent">
        <!-- Summary Cards -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
            <!-- Total Box -->
            <div class="bg-white rounded-xl p-6 shadow-sm card-accent-top">
                <div class="flex justify-between items-start">
                    <div>
                        <p class="text-gray-500 text-sm">Total Box</p>
                        <h2 id="totalBox" class="text-3xl font-bold mt-1" style="color: #002A3A;">0</h2>
                        <p id="dddLjbbBreakdown" class="text-gray-400 text-xs mt-2">DDD: 0 | LJBB: 0</p>
                    </div>
                    <div class="p-3 rounded-lg" style="background: #00E273;">
                        <svg class="w-6 h-6" fill="#002A3A" viewBox="0 0 20 20">
                            <path d="M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4zm12 12H4l4-8 3 6 2-4 3 6z"></path>
                        </svg>
                    </div>
                </div>
            </div>

            <!-- Utilisasi -->
            <div class="bg-white rounded-xl p-6 shadow-sm card-accent-top">
                <div class="flex justify-between items-start">
                    <div>
                        <p class="text-gray-500 text-sm">Utilisasi Gudang</p>
                        <h2 id="utilization" class="text-3xl font-bold mt-1" style="color: #002A3A;">50.42%</h2>
                        <p class="text-gray-400 text-xs mt-2">Kapasitas: 10,000 box</p>
                    </div>
                    <div class="p-3 rounded-lg" style="background: #00E273;">
                        <svg class="w-6 h-6" fill="#002A3A" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M3 3a1 1 0 000 2v8a2 2 0 002 2h2.586l-1.293 1.293a1 1 0 101.414 1.414L10 15.414l2.293 2.293a1 1 0 001.414-1.414L12.414 15H15a2 2 0 002-2V5a1 1 0 100-2H3zm11.707 4.707a1 1 0 00-1.414-1.414L10 9.586 8.707 8.293a1 1 0 00-1.414 0l-2 2a1 1 0 101.414 1.414L8 10.414l1.293 1.293a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                        </svg>
                    </div>
                </div>
            </div>

            <!-- Total Pairs -->
            <div class="bg-white rounded-xl p-6 shadow-sm card-accent-top">
                <div class="flex justify-between items-start">
                    <div>
                        <p class="text-gray-500 text-sm">Total Pairs</p>
                        <h2 id="totalPairs" class="text-3xl font-bold mt-1" style="color: #002A3A;">60,504</h2>
                        <p class="text-gray-400 text-xs mt-2">12 pairs/box</p>
                    </div>
                    <div class="p-3 rounded-lg" style="background: #00E273;">
                        <svg class="w-6 h-6" fill="#002A3A" viewBox="0 0 20 20">
                            <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                            <path fill-rule="evenodd" d="M4 5a2 2 0 012-2 3 3 0 003 3h2a3 3 0 003-3 2 2 0 012 2v11a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3zm-3 4a1 1 0 100 2h.01a1 1 0 100-2H7zm3 0a1 1 0 100 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                        </svg>
                    </div>
                </div>
            </div>

            <!-- Total Artikel -->
            <div class="bg-white rounded-xl p-6 shadow-sm card-accent-top">
                <div class="flex justify-between items-start">
                    <div>
                        <p class="text-gray-500 text-sm">Total Artikel</p>
                        <h2 id="totalArtikel" class="text-3xl font-bold mt-1" style="color: #002A3A;">901</h2>
                        <p class="text-gray-400 text-xs mt-2">SKU Aktif</p>
                    </div>
                    <div class="p-3 rounded-lg" style="background: #00E273;">
                        <svg class="w-6 h-6" fill="#002A3A" viewBox="0 0 20 20">
                            <path d="M7 3a1 1 0 000 2h6a1 1 0 100-2H7zM4 7a1 1 0 011-1h10a1 1 0 110 2H5a1 1 0 01-1-1zM2 11a2 2 0 012-2h12a2 2 0 012 2v4a2 2 0 01-2 2H4a2 2 0 01-2-2v-4z"></path>
                        </svg>
                    </div>
                </div>
            </div>
        </div>


        <!-- Charts Row -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
            <!-- Tier Distribution Chart -->
            <div class="bg-white rounded-xl shadow-sm p-6 lg:col-span-2">
                <div class="flex justify-between items-start mb-4">
                    <div>
                        <h3 class="text-lg font-semibold text-gray-800">üìä Distribusi Stok per Tier</h3>
                        <p class="text-sm text-gray-500 mt-1">üëÜ Klik bar untuk melihat detail artikel tier tersebut</p>
                    </div>
                </div>
                <canvas id="tierChart" height="120"></canvas>
            </div>

            <!-- Utilization Gauge -->
            <div class="bg-white rounded-xl shadow-sm p-6">
                <h3 class="text-lg font-semibold text-gray-800 mb-4">üéØ Kapasitas Gudang</h3>
                <div class="flex flex-col items-center">
                    <div class="relative w-48 h-48">
                        <svg class="w-full h-full transform -rotate-90" viewBox="0 0 100 100">
                            <circle cx="50" cy="50" r="40" fill="none" stroke="#e5e7eb" stroke-width="12"/>
                            <circle id="gaugeCircle" cx="50" cy="50" r="40" fill="none" stroke="#00E273" stroke-width="12" 
                                stroke-dasharray="251.2" stroke-dashoffset="124.6" stroke-linecap="round"/>
                        </svg>
                        <div class="absolute inset-0 flex flex-col items-center justify-center">
                            <span id="gaugePercent" class="text-3xl font-bold" style="color: #002A3A;">50.42%</span>
                            <span class="text-sm text-gray-500">Terisi</span>
                        </div>
                    </div>
                    <div class="mt-4 w-full">
                        <div class="flex justify-between text-sm text-gray-600 mb-1">
                            <span>Terpakai</span>
                            <span id="usedCapacity">5,042 box</span>
                        </div>
                        <div class="flex justify-between text-sm text-gray-600">
                            <span>Tersedia</span>
                            <span id="availableCapacity">4,958 box</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tier Breakdown Table -->
        <div class="bg-white rounded-xl shadow-sm p-6 mb-6">
            <h3 class="text-lg font-semibold text-gray-800 mb-4">üìã Breakdown per Tier <span class="text-sm font-normal text-gray-500">(Klik tier untuk melihat detail artikel)</span></h3>
            <div class="overflow-x-auto">
                <table class="w-full">
                    <thead>
                        <tr class="border-b border-gray-200">
                            <th class="text-left py-3 px-4 text-sm font-semibold text-gray-600">Tier</th>
                            <th class="text-right py-3 px-4 text-sm font-semibold text-gray-600">Jumlah Artikel</th>
                            <th class="text-right py-3 px-4 text-sm font-semibold text-gray-600">Total Box</th>
                            <th class="text-right py-3 px-4 text-sm font-semibold text-gray-600">Total Pairs</th>
                            <th class="text-right py-3 px-4 text-sm font-semibold text-gray-600">Persentase</th>
                            <th class="py-3 px-4 text-sm font-semibold text-gray-600">Progress</th>
                        </tr>
                    </thead>
                    <tbody id="tierTableBody">
                        <!-- Data akan diisi oleh JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Entity Comparison -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
            <!-- DDD vs LJBB -->
            <div class="bg-white rounded-xl shadow-sm p-6">
                <h3 class="text-lg font-semibold text-gray-800 mb-4">üè¢ Perbandingan Entitas</h3>
                <canvas id="entityChart" height="200"></canvas>
            </div>

            <!-- Recent Activity -->
            <div class="bg-white rounded-xl shadow-sm p-6">
                <h3 class="text-lg font-semibold text-gray-800 mb-4">üïê Aktivitas Terakhir</h3>
                <div id="activityList" class="space-y-3">
                    <!-- Data akan diisi oleh JavaScript -->
                </div>
            </div>
        </div>

        <!-- Barang IN / OUT Section -->
        <div class="bg-white rounded-xl shadow-sm p-6 mb-6">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-6">
                <div>
                    <h3 class="text-lg font-semibold text-gray-800">üì¶ Mutasi Barang IN & OUT</h3>
                    <p class="text-sm text-gray-500 mt-1">Monitoring pergerakan stok masuk dan keluar</p>
                </div>
                <div class="flex gap-2">
                    <button onclick="setMutasiPeriod('today')" id="btnToday" class="px-4 py-2 text-white rounded-lg text-sm font-medium" style="background: #002A3A;">Hari Ini</button>
                    <button onclick="setMutasiPeriod('week')" id="btnWeek" class="px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 text-sm font-medium">Minggu Ini</button>
                    <button onclick="setMutasiPeriod('month')" id="btnMonth" class="px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 text-sm font-medium">Bulan Ini</button>
                </div>
            </div>

            <!-- IN/OUT Summary Cards -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                <!-- Barang Masuk -->
                <div class="bg-gradient-to-br from-green-50 to-green-100 rounded-xl p-5 border border-green-200">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-green-600 text-sm font-medium">üì• Barang Masuk</p>
                            <h3 id="totalIn" class="text-3xl font-bold text-green-700 mt-1">45</h3>
                            <p class="text-green-500 text-xs mt-1">Box</p>
                        </div>
                        <div class="w-12 h-12 bg-green-500 rounded-full flex items-center justify-center">
                            <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 14l-7 7m0 0l-7-7m7 7V3"></path>
                            </svg>
                        </div>
                    </div>
                </div>

                <!-- Barang Keluar -->
                <div class="bg-gradient-to-br from-red-50 to-red-100 rounded-xl p-5 border border-red-200">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-red-600 text-sm font-medium">üì§ Barang Keluar</p>
                            <h3 id="totalOut" class="text-3xl font-bold text-red-700 mt-1">32</h3>
                            <p class="text-red-500 text-xs mt-1">Box</p>
                        </div>
                        <div class="w-12 h-12 bg-red-500 rounded-full flex items-center justify-center">
                            <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18"></path>
                            </svg>
                        </div>
                    </div>
                </div>

                <!-- Selisih -->
                <div class="bg-gradient-to-br from-blue-50 to-blue-100 rounded-xl p-5 border border-blue-200">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-blue-600 text-sm font-medium">üìä Selisih (IN - OUT)</p>
                            <h3 id="netMutasi" class="text-3xl font-bold text-blue-700 mt-1">+13</h3>
                            <p class="text-blue-500 text-xs mt-1">Box</p>
                        </div>
                        <div class="w-12 h-12 bg-blue-500 rounded-full flex items-center justify-center">
                            <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                            </svg>
                        </div>
                    </div>
                </div>

                <!-- Total Transaksi -->
                <div class="bg-gradient-to-br from-purple-50 to-purple-100 rounded-xl p-5 border border-purple-200">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-purple-600 text-sm font-medium">üîÑ Total Transaksi</p>
                            <h3 id="totalTransaksi" class="text-3xl font-bold text-purple-700 mt-1">77</h3>
                            <p class="text-purple-500 text-xs mt-1">Transaksi</p>
                        </div>
                        <div class="w-12 h-12 bg-purple-500 rounded-full flex items-center justify-center">
                            <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"></path>
                            </svg>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Chart IN/OUT -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                <!-- Line Chart Trend -->
                <div class="bg-gray-50 rounded-xl p-4">
                    <h4 class="text-sm font-semibold text-gray-700 mb-3">üìà Trend Mutasi 7 Hari Terakhir</h4>
                    <canvas id="mutasiLineChart" height="200"></canvas>
                </div>

                <!-- Bar Chart Comparison -->
                <div class="bg-gray-50 rounded-xl p-4">
                    <h4 class="text-sm font-semibold text-gray-700 mb-3">üìä Perbandingan IN vs OUT</h4>
                    <canvas id="mutasiBarChart" height="200"></canvas>
                </div>
            </div>

            <!-- Tabs dan Search untuk Tabel IN/OUT -->
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-4">
                <!-- Tabs -->
                <div class="border-b border-gray-200">
                    <nav class="flex gap-4">
                        <button onclick="showMutasiTab('in')" id="tabIn" class="px-4 py-2 border-b-2 border-green-500 text-green-600 font-medium text-sm flex items-center gap-2">
                            <span class="w-2 h-2 bg-green-500 rounded-full"></span>
                            Barang Masuk (IN)
                            <span id="countIn" class="bg-green-100 text-green-700 text-xs px-2 py-0.5 rounded-full">8</span>
                        </button>
                        <button onclick="showMutasiTab('out')" id="tabOut" class="px-4 py-2 border-b-2 border-transparent text-gray-500 hover:text-gray-700 font-medium text-sm flex items-center gap-2">
                            <span class="w-2 h-2 bg-red-500 rounded-full"></span>
                            Barang Keluar (OUT)
                            <span id="countOut" class="bg-red-100 text-red-700 text-xs px-2 py-0.5 rounded-full">8</span>
                        </button>
                    </nav>
                </div>

                <!-- Search Box untuk IN/OUT -->
                <div class="flex flex-col sm:flex-row gap-3 w-full md:w-auto">
                    <div class="relative">
                        <span class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                            </svg>
                        </span>
                        <input type="text" id="searchMutasi" placeholder="Cari kode/nama artikel..." 
                            class="pl-9 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:outline-none text-sm w-full sm:w-56"
                            style="--tw-ring-color: #00E273;"
                            onkeyup="filterMutasiTable()">
                    </div>
                    <select id="filterSumberTujuan" class="px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:outline-none bg-white text-sm" style="--tw-ring-color: #00E273;" onchange="filterMutasiTable()">
                        <option value="">Semua Sumber/Tujuan</option>
                        <option value="Produksi">üì¶ Produksi</option>
                        <option value="Retur">üîÑ Retur</option>
                        <option value="Transfer">üöö Transfer</option>
                        <option value="Store">üè™ Store</option>
                        <option value="Online">üåê Online Order</option>
                    </select>
                    <button onclick="resetMutasiFilter()" class="px-3 py-2 rounded-lg font-medium flex items-center justify-center gap-1 transition-all hover:opacity-90 text-sm" style="background: #002A3A; color: white;">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                        </svg>
                        Reset
                    </button>
                </div>
            </div>

            <!-- Filter Info untuk Mutasi -->
            <p id="mutasiFilterInfo" class="text-sm mb-3 hidden px-3 py-1.5 rounded-lg inline-flex items-center gap-2" style="background: rgba(0, 226, 115, 0.1); color: #00c264;"></p>

            <!-- Tabel Barang Masuk -->
            <div id="tableIn" class="overflow-x-auto rounded-lg border border-green-200">
                <table class="w-full">
                    <thead style="background: #002A3A;">
                        <tr>
                            <th class="text-left py-3 px-4 text-sm font-semibold text-white">Tanggal</th>
                            <th class="text-left py-3 px-4 text-sm font-semibold text-white">Kode Artikel</th>
                            <th class="text-left py-3 px-4 text-sm font-semibold text-white">Nama Artikel</th>
                            <th class="text-center py-3 px-4 text-sm font-semibold text-white">Tier</th>
                            <th class="text-right py-3 px-4 text-sm font-semibold text-white">Qty Box</th>
                            <th class="text-right py-3 px-4 text-sm font-semibold text-white">Pairs</th>
                            <th class="text-left py-3 px-4 text-sm font-semibold text-white">Sumber</th>
                        </tr>
                    </thead>
                    <tbody id="tableInBody">
                        <!-- Data akan diisi oleh JavaScript -->
                    </tbody>
                </table>
            </div>

            <!-- Tabel Barang Keluar -->
            <div id="tableOut" class="overflow-x-auto hidden rounded-lg border border-red-200">
                <table class="w-full">
                    <thead style="background: #002A3A;">
                        <tr>
                            <th class="text-left py-3 px-4 text-sm font-semibold text-white">Tanggal</th>
                            <th class="text-left py-3 px-4 text-sm font-semibold text-white">Kode Artikel</th>
                            <th class="text-left py-3 px-4 text-sm font-semibold text-white">Nama Artikel</th>
                            <th class="text-center py-3 px-4 text-sm font-semibold text-white">Tier</th>
                            <th class="text-right py-3 px-4 text-sm font-semibold text-white">Qty Box</th>
                            <th class="text-right py-3 px-4 text-sm font-semibold text-white">Pairs</th>
                            <th class="text-left py-3 px-4 text-sm font-semibold text-white">Tujuan</th>
                        </tr>
                    </thead>
                    <tbody id="tableOutBody">
                        <!-- Data akan diisi oleh JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Search and Filter -->
        <div id="artikelSection" class="bg-white rounded-xl shadow-sm p-6 transition-all duration-300">
            <!-- Header Section -->
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-6">
                <div>
                    <h3 class="text-lg font-semibold text-gray-800 flex items-center gap-2">
                        <span class="w-8 h-8 rounded-lg flex items-center justify-center" style="background: #00E273;">
                            <svg class="w-4 h-4" fill="#002A3A" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd"></path>
                            </svg>
                        </span>
                        Pencarian Artikel
                    </h3>
                    <p class="text-sm text-gray-500 mt-1">Cari dan filter data artikel berdasarkan kode, nama, tier, atau status stok</p>
                    <p id="activeFilterInfo" class="text-sm mt-2 hidden px-3 py-1 rounded-full inline-flex items-center gap-2" style="background: rgba(0, 226, 115, 0.1); color: #00c264;"></p>
                </div>
            </div>

            <!-- Search & Filter Controls -->
            <div class="bg-gray-50 rounded-xl p-4 mb-6">
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4">
                    <!-- Search Input -->
                    <div class="lg:col-span-2">
                        <label class="block text-xs font-medium text-gray-500 mb-1">Cari Artikel</label>
                        <div class="relative">
                            <span class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                                </svg>
                            </span>
                            <input type="text" id="searchInput" placeholder="Ketik kode atau nama artikel..." 
                                class="w-full pl-10 pr-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:outline-none transition-all"
                                style="--tw-ring-color: #00E273;"
                                onkeyup="filterTable()">
                        </div>
                    </div>

                    <!-- Tier Filter -->
                    <div>
                        <label class="block text-xs font-medium text-gray-500 mb-1">Filter Tier</label>
                        <select id="tierFilter" class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:outline-none bg-white transition-all" style="--tw-ring-color: #00E273;" onchange="filterTable()">
                            <option value="">Semua Tier</option>
                            <option value="1">üîµ Tier 1</option>
                            <option value="2">üü¢ Tier 2</option>
                            <option value="3">üü° Tier 3</option>
                            <option value="4">üü† Tier 4</option>
                            <option value="5">üî¥ Tier 5</option>
                            <option value="8">üü£ Tier 8</option>
                        </select>
                    </div>

                    <!-- Stock Filter -->
                    <div>
                        <label class="block text-xs font-medium text-gray-500 mb-1">Status Stok</label>
                        <select id="stockFilter" class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:outline-none bg-white transition-all" style="--tw-ring-color: #00E273;" onchange="filterTable()">
                            <option value="">Semua Status</option>
                            <option value="hasStock">‚úÖ Ada Stok</option>
                            <option value="noStock">‚ùå Stok Habis</option>
                        </select>
                    </div>

                    <!-- Reset Button -->
                    <div>
                        <label class="block text-xs font-medium text-gray-500 mb-1">&nbsp;</label>
                        <button onclick="resetFilters()" class="w-full px-4 py-2.5 rounded-lg font-medium flex items-center justify-center gap-2 transition-all hover:opacity-90" style="background: #002A3A; color: white;">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                            </svg>
                            Reset Filter
                        </button>
                    </div>
                </div>

                <!-- Quick Stats -->
                <div class="flex flex-wrap gap-4 mt-4 pt-4 border-t border-gray-200">
                    <div class="flex items-center gap-2 text-sm">
                        <span class="w-2 h-2 rounded-full" style="background: #00E273;"></span>
                        <span class="text-gray-600">Total Artikel: <strong id="quickTotalArtikel" style="color: #002A3A;">901</strong></span>
                    </div>
                    <div class="flex items-center gap-2 text-sm">
                        <span class="w-2 h-2 rounded-full bg-green-500"></span>
                        <span class="text-gray-600">Ada Stok: <strong class="text-green-600" id="quickHasStock">631</strong></span>
                    </div>
                    <div class="flex items-center gap-2 text-sm">
                        <span class="w-2 h-2 rounded-full bg-red-500"></span>
                        <span class="text-gray-600">Stok Habis: <strong class="text-red-600" id="quickNoStock">270</strong></span>
                    </div>
                </div>
            </div>

            <!-- Data Table -->
            <div class="overflow-x-auto rounded-lg border border-gray-200">
                <table class="w-full">
                    <thead>
                        <tr style="background: #002A3A;">
                            <th class="text-left py-3 px-4 text-sm font-semibold text-white">No</th>
                            <th class="text-left py-3 px-4 text-sm font-semibold text-white">Kode Artikel</th>
                            <th class="text-left py-3 px-4 text-sm font-semibold text-white">Nama Artikel</th>
                            <th class="text-center py-3 px-4 text-sm font-semibold text-white">Tier</th>
                            <th class="text-right py-3 px-4 text-sm font-semibold text-white">Box DDD</th>
                            <th class="text-right py-3 px-4 text-sm font-semibold text-white">Box LJBB</th>
                            <th class="text-right py-3 px-4 text-sm font-semibold text-white">Total Box</th>
                            <th class="text-right py-3 px-4 text-sm font-semibold text-white">Pairs</th>
                            <th class="text-center py-3 px-4 text-sm font-semibold text-white">Status</th>
                        </tr>
                    </thead>
                    <tbody id="artikelTableBody">
                        <!-- Data akan diisi oleh JavaScript -->
                    </tbody>
                </table>
            </div>

            <!-- Pagination -->
            <div class="mt-4 flex flex-col sm:flex-row justify-between items-center gap-4">
                <span id="tableInfo" class="text-sm text-gray-600">Menampilkan 0 dari 0 artikel</span>
                <div class="flex items-center gap-2">
                    <button onclick="prevPage()" class="px-4 py-2 rounded-lg font-medium flex items-center gap-1 transition-all hover:opacity-90" style="background: #f3f4f6; color: #002A3A;">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                        </svg>
                        Prev
                    </button>
                    <span id="pageInfo" class="px-4 py-2 rounded-lg font-semibold" style="background: #00E273; color: #002A3A;">Page 1</span>
                    <button onclick="nextPage()" class="px-4 py-2 rounded-lg font-medium flex items-center gap-1 transition-all hover:opacity-90" style="background: #f3f4f6; color: #002A3A;">
                        Next
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                        </svg>
                    </button>
                </div>
            </div>
        </div>
        </div><!-- End of stockTabContent -->
        
        <!-- IG & RM Monitoring Tab Content -->
        <div id="igrmTabContent" class="hidden">
            <!-- Summary Cards -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                <div class="bg-white rounded-xl p-5 shadow-sm card-accent-top">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm text-gray-500">Total Item</p>
                            <p class="text-2xl font-bold text-gray-800" id="igrmTotalItem">0</p>
                        </div>
                        <div class="w-12 h-12 rounded-full bg-blue-100 flex items-center justify-center">
                            <span class="text-xl">üì¶</span>
                        </div>
                    </div>
                </div>
                <div class="bg-white rounded-xl p-5 shadow-sm border-t-4 border-green-500">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm text-gray-500">Done</p>
                            <p class="text-2xl font-bold text-green-600" id="igrmDone">0</p>
                        </div>
                        <div class="w-12 h-12 rounded-full bg-green-100 flex items-center justify-center">
                            <span class="text-xl">‚úÖ</span>
                        </div>
                    </div>
                </div>
                <div class="bg-white rounded-xl p-5 shadow-sm border-t-4 border-yellow-500">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm text-gray-500">Packing</p>
                            <p class="text-2xl font-bold text-yellow-600" id="igrmPacking">0</p>
                        </div>
                        <div class="w-12 h-12 rounded-full bg-yellow-100 flex items-center justify-center">
                            <span class="text-xl">üì¶</span>
                        </div>
                    </div>
                </div>
                <div class="bg-white rounded-xl p-5 shadow-sm border-t-4 border-red-500">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm text-gray-500">Outstanding</p>
                            <p class="text-2xl font-bold text-red-600" id="igrmOutstanding">0</p>
                        </div>
                        <div class="w-12 h-12 rounded-full bg-red-100 flex items-center justify-center">
                            <span class="text-xl">‚è≥</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Filter & Search -->
            <div class="bg-white rounded-xl shadow-sm p-6 mb-6">
                <div class="flex flex-wrap gap-4 items-center justify-between">
                    <div class="flex gap-2">
                        <button onclick="filterIGRM('all')" id="igrmFilterAll" class="px-4 py-2 rounded-lg text-sm font-medium bg-gray-800 text-white">
                            Semua
                        </button>
                        <button onclick="filterIGRM('Done')" id="igrmFilterDone" class="px-4 py-2 rounded-lg text-sm font-medium bg-gray-100 text-gray-700 hover:bg-gray-200">
                            ‚úÖ Done
                        </button>
                        <button onclick="filterIGRM('Packing')" id="igrmFilterPacking" class="px-4 py-2 rounded-lg text-sm font-medium bg-gray-100 text-gray-700 hover:bg-gray-200">
                            üì¶ Packing
                        </button>
                        <button onclick="filterIGRM('Outstanding')" id="igrmFilterOutstanding" class="px-4 py-2 rounded-lg text-sm font-medium bg-gray-100 text-gray-700 hover:bg-gray-200">
                            ‚è≥ Outstanding
                        </button>
                    </div>
                    <div class="flex gap-4 items-center">
                        <select id="igrmJenisFilter" onchange="applyIGRMFilters()" class="px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:outline-none bg-white text-sm">
                            <option value="">Semua Jenis</option>
                            <option value="Sandal">Sandal</option>
                            <option value="Insole">Insole</option>
                        </select>
                        <input type="text" id="igrmSearch" placeholder="Cari kode/deskripsi..." 
                            class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:outline-none text-sm w-64"
                            onkeyup="applyIGRMFilters()">
                    </div>
                </div>
            </div>
            
            <!-- IG & RM Table -->
            <div class="bg-white rounded-xl shadow-sm overflow-hidden">
                <div class="px-6 py-4 border-b flex justify-between items-center">
                    <h3 class="font-bold text-gray-800">üè≠ Monitoring Intermedied Good & Raw Material</h3>
                    <span id="igrmTableInfo" class="text-sm text-gray-500">Menampilkan 0 item</span>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="text-left py-3 px-4 text-sm font-semibold text-gray-600">No</th>
                                <th class="text-left py-3 px-4 text-sm font-semibold text-gray-600">Jenis</th>
                                <th class="text-left py-3 px-4 text-sm font-semibold text-gray-600">Kode Artikel</th>
                                <th class="text-left py-3 px-4 text-sm font-semibold text-gray-600">Deskripsi</th>
                                <th class="text-right py-3 px-4 text-sm font-semibold text-gray-600">Qty (pair)</th>
                                <th class="text-center py-3 px-4 text-sm font-semibold text-gray-600">Tgl Masuk Supplier</th>
                                <th class="text-center py-3 px-4 text-sm font-semibold text-gray-600">Tgl Kirim HJS</th>
                                <th class="text-center py-3 px-4 text-sm font-semibold text-gray-600">Tgl Masuk WHS</th>
                                <th class="text-center py-3 px-4 text-sm font-semibold text-gray-600">Status</th>
                            </tr>
                        </thead>
                        <tbody id="igrmTableBody">
                            <!-- Data akan diisi oleh JavaScript -->
                        </tbody>
                    </table>
                </div>
                <div class="px-6 py-4 border-t bg-gray-50 flex justify-between items-center">
                    <span id="igrmPaginationInfo" class="text-sm text-gray-500">Halaman 1</span>
                    <div class="flex gap-2">
                        <button onclick="igrmPrevPage()" id="igrmPrevBtn" class="px-3 py-1 bg-gray-200 rounded hover:bg-gray-300 disabled:opacity-50" disabled>
                            ‚Üê Prev
                        </button>
                        <button onclick="igrmNextPage()" id="igrmNextBtn" class="px-3 py-1 bg-gray-200 rounded hover:bg-gray-300 disabled:opacity-50">
                            Next ‚Üí
                        </button>
                    </div>
                </div>
            </div>
        </div><!-- End of igrmTabContent -->
    </main>

    <!-- Footer -->
    <footer class="zuma-header mt-8 py-6">
        <div class="max-w-7xl mx-auto px-4">
            <div class="flex flex-col md:flex-row justify-between items-center gap-4">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 rounded-lg flex items-center justify-center" style="background: #00E273;">
                        <svg width="24" height="24" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <!-- ZUMA Logogram - Stylized flowing Z -->
                            <path d="M15 22 L40 22 Q50 22, 45 32 L25 58 Q20 66, 28 66 L85 66 L85 78 L28 78 Q8 78, 18 62 L42 32 Q48 22, 38 10 L15 10 Z" fill="#002A3A"/>
                        </svg>
                    </div>
                    <div>
                        <p class="text-white font-semibold">ZUMA Dashboard</p>
                        <p class="text-gray-400 text-xs">Warehouse Management System</p>
                    </div>
                </div>
                <p class="text-gray-400 text-sm">¬© 2026 ZUMA Sandal. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script>
        // ==========================================
        // KONFIGURASI GOOGLE SHEETS API
        // ==========================================
        const SPREADSHEET_ID = '1CLbpcsBiN8GsC2RbiKMN73rlTdLjriQucXhD-LoGlq4';
        const API_KEY = 'AIzaSyBLmrYiydwSWdipHjUUnpXuC4Ruc_fEB7A';
        const SHEET_REKAPAN = 'Rekapan Box';
        const SHEET_TRANSAKSI = 'Transaksi';
        
        // Spreadsheet IG & RM (Monitoring Intermedied Good & Raw Material)
        const IGRM_SPREADSHEET_ID = '1JDO388Ee02a2qYg-39ySUxYkV48m-LYvPgIT32FvE5s';
        const IGRM_SHEET_NAME = 'table';
        
        // Kapasitas maksimum gudang (dalam box)
        const MAX_CAPACITY = 10000;
        
        // Current active tab
        let activeMainTab = 'stock';

        // Data akan diisi dari Google Sheets
        let stockData = {
            summary: {
                totalBox: 0,
                boxDDD: 0,
                boxLJBB: 0,
                totalPairs: 0,
                totalArtikel: 0,
                capacity: MAX_CAPACITY,
                utilization: 0
            },
            mutasi: {
                todayIn: 0,
                todayOut: 0,
                weekIn: 0,
                weekOut: 0,
                monthIn: 0,
                monthOut: 0
            },
            transaksiIn: [],
            transaksiOut: [],
            dailyMutasi: [],
            tierBreakdown: [],
            articles: []
        };
        
        // IG & RM Data
        let igrmData = {
            items: [],
            filteredItems: [],
            currentFilter: 'all',
            currentPage: 1,
            itemsPerPage: 20,
            summary: {
                total: 0,
                done: 0,
                packing: 0,
                outstanding: 0
            }
        };

        // ==========================================
        // FUNGSI SWITCH TAB UTAMA
        // ==========================================
        function switchMainTab(tab) {
            activeMainTab = tab;
            
            const stockTab = document.getElementById('mainTabStock');
            const igrmTab = document.getElementById('mainTabIGRM');
            const stockContent = document.getElementById('stockTabContent');
            const igrmContent = document.getElementById('igrmTabContent');
            
            if (tab === 'stock') {
                // Aktifkan tab Stock
                stockTab.className = 'px-5 py-2.5 rounded-t-lg font-semibold text-sm transition-all bg-gray-100 text-gray-800 border-t-2 border-x-2 border-gray-200';
                stockTab.style.marginBottom = '-1px';
                stockTab.style.position = 'relative';
                stockTab.style.zIndex = '10';
                
                igrmTab.className = 'px-5 py-2.5 rounded-t-lg font-semibold text-sm transition-all text-gray-400 hover:text-gray-600 hover:bg-gray-50';
                igrmTab.style.marginBottom = '';
                igrmTab.style.position = '';
                igrmTab.style.zIndex = '';
                
                stockContent.classList.remove('hidden');
                igrmContent.classList.add('hidden');
            } else {
                // Aktifkan tab IG & RM
                igrmTab.className = 'px-5 py-2.5 rounded-t-lg font-semibold text-sm transition-all bg-gray-100 text-gray-800 border-t-2 border-x-2 border-gray-200';
                igrmTab.style.marginBottom = '-1px';
                igrmTab.style.position = 'relative';
                igrmTab.style.zIndex = '10';
                
                stockTab.className = 'px-5 py-2.5 rounded-t-lg font-semibold text-sm transition-all text-gray-400 hover:text-gray-600 hover:bg-gray-50';
                stockTab.style.marginBottom = '';
                stockTab.style.position = '';
                stockTab.style.zIndex = '';
                
                stockContent.classList.add('hidden');
                igrmContent.classList.remove('hidden');
                
                // Load IGRM data jika belum
                if (igrmData.items.length === 0) {
                    loadIGRMData();
                }
            }
        }

        // ==========================================
        // FUNGSI LOAD DATA IG & RM
        // ==========================================
        async function loadIGRMData() {
            showLoading(true);
            
            try {
                const url = `https://sheets.googleapis.com/v4/spreadsheets/${IGRM_SPREADSHEET_ID}/values/${encodeURIComponent(IGRM_SHEET_NAME)}!A2:I1000?key=${API_KEY}`;
                const response = await fetch(url);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                const rows = data.values || [];
                
                console.log('IGRM Data loaded:', rows.length, 'rows');
                
                // Parse data
                igrmData.items = rows.map((row, idx) => ({
                    no: parseInt(row[0]) || (idx + 1),
                    jenis: row[1] || '',
                    kode: row[2] || '',
                    deskripsi: row[3] || '',
                    qty: parseInt(String(row[4] || '0').replace(/,/g, '')) || 0,
                    tglMasukSupplier: row[5] || '',
                    tglKirimHJS: row[6] || '',
                    tglMasukWHS: row[7] || '',
                    status: (row[8] || '').trim()
                })).filter(item => item.kode || item.deskripsi);
                
                // Calculate summary
                igrmData.summary.total = igrmData.items.length;
                igrmData.summary.done = igrmData.items.filter(i => i.status.toLowerCase() === 'done').length;
                igrmData.summary.packing = igrmData.items.filter(i => i.status.toLowerCase() === 'packing').length;
                igrmData.summary.outstanding = igrmData.items.filter(i => i.status.toLowerCase() === 'outstanding').length;
                
                // Update UI
                updateIGRMSummary();
                applyIGRMFilters();
                
            } catch (error) {
                console.error('Error loading IGRM data:', error);
                document.getElementById('igrmTableBody').innerHTML = `
                    <tr>
                        <td colspan="9" class="py-8 text-center text-red-500">
                            <p>‚ùå Gagal memuat data</p>
                            <p class="text-sm text-gray-400 mt-1">${error.message}</p>
                            <button onclick="loadIGRMData()" class="mt-2 text-blue-600 hover:underline">Coba lagi</button>
                        </td>
                    </tr>
                `;
            } finally {
                showLoading(false);
            }
        }
        
        function updateIGRMSummary() {
            document.getElementById('igrmTotalItem').textContent = igrmData.summary.total.toLocaleString('id-ID');
            document.getElementById('igrmDone').textContent = igrmData.summary.done.toLocaleString('id-ID');
            document.getElementById('igrmPacking').textContent = igrmData.summary.packing.toLocaleString('id-ID');
            document.getElementById('igrmOutstanding').textContent = igrmData.summary.outstanding.toLocaleString('id-ID');
        }
        
        function filterIGRM(status) {
            igrmData.currentFilter = status;
            igrmData.currentPage = 1;
            
            // Update button styles
            const buttons = ['All', 'Done', 'Packing', 'Outstanding'];
            buttons.forEach(btn => {
                const el = document.getElementById(`igrmFilter${btn}`);
                if (btn.toLowerCase() === status.toLowerCase() || (status === 'all' && btn === 'All')) {
                    el.className = 'px-4 py-2 rounded-lg text-sm font-medium bg-gray-800 text-white';
                } else {
                    el.className = 'px-4 py-2 rounded-lg text-sm font-medium bg-gray-100 text-gray-700 hover:bg-gray-200';
                }
            });
            
            applyIGRMFilters();
        }
        
        function applyIGRMFilters() {
            const searchTerm = (document.getElementById('igrmSearch')?.value || '').toLowerCase();
            const jenisFilter = document.getElementById('igrmJenisFilter')?.value || '';
            
            igrmData.filteredItems = igrmData.items.filter(item => {
                // Filter by status
                if (igrmData.currentFilter !== 'all' && item.status.toLowerCase() !== igrmData.currentFilter.toLowerCase()) {
                    return false;
                }
                
                // Filter by jenis
                if (jenisFilter && item.jenis !== jenisFilter) {
                    return false;
                }
                
                // Filter by search
                if (searchTerm) {
                    const matchKode = item.kode.toLowerCase().includes(searchTerm);
                    const matchDeskripsi = item.deskripsi.toLowerCase().includes(searchTerm);
                    if (!matchKode && !matchDeskripsi) {
                        return false;
                    }
                }
                
                return true;
            });
            
            renderIGRMTable();
        }
        
        function renderIGRMTable() {
            const tbody = document.getElementById('igrmTableBody');
            const start = (igrmData.currentPage - 1) * igrmData.itemsPerPage;
            const end = start + igrmData.itemsPerPage;
            const pageItems = igrmData.filteredItems.slice(start, end);
            
            if (pageItems.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="9" class="py-8 text-center text-gray-400">
                            Tidak ada data yang sesuai filter
                        </td>
                    </tr>
                `;
            } else {
                tbody.innerHTML = pageItems.map((item, idx) => {
                    // Status badge style
                    let statusBadge = '';
                    const statusLower = item.status.toLowerCase();
                    if (statusLower === 'done') {
                        statusBadge = '<span class="px-3 py-1 rounded-full text-xs font-medium bg-green-500 text-white">Done</span>';
                    } else if (statusLower === 'packing') {
                        statusBadge = '<span class="px-3 py-1 rounded-full text-xs font-medium bg-yellow-400 text-gray-800">Packing</span>';
                    } else if (statusLower === 'outstanding') {
                        statusBadge = '<span class="px-3 py-1 rounded-full text-xs font-medium bg-red-500 text-white">Outstanding</span>';
                    } else {
                        statusBadge = `<span class="px-3 py-1 rounded-full text-xs font-medium bg-gray-200 text-gray-600">${item.status || '-'}</span>`;
                    }
                    
                    return `
                        <tr class="border-b hover:bg-gray-50 ${idx % 2 === 0 ? '' : 'bg-gray-50'}">
                            <td class="py-3 px-4 text-sm">${start + idx + 1}</td>
                            <td class="py-3 px-4 text-sm">
                                <span class="px-2 py-1 rounded text-xs ${item.jenis === 'Sandal' ? 'bg-blue-100 text-blue-700' : 'bg-purple-100 text-purple-700'}">
                                    ${item.jenis}
                                </span>
                            </td>
                            <td class="py-3 px-4 text-sm font-medium text-blue-600">${item.kode}</td>
                            <td class="py-3 px-4 text-sm">${item.deskripsi}</td>
                            <td class="py-3 px-4 text-sm text-right font-medium">${item.qty.toLocaleString('id-ID')}</td>
                            <td class="py-3 px-4 text-sm text-center">${formatDate(item.tglMasukSupplier)}</td>
                            <td class="py-3 px-4 text-sm text-center">${formatDate(item.tglKirimHJS)}</td>
                            <td class="py-3 px-4 text-sm text-center">${formatDate(item.tglMasukWHS)}</td>
                            <td class="py-3 px-4 text-center">${statusBadge}</td>
                        </tr>
                    `;
                }).join('');
            }
            
            // Update info
            const totalFiltered = igrmData.filteredItems.length;
            const totalPages = Math.ceil(totalFiltered / igrmData.itemsPerPage);
            document.getElementById('igrmTableInfo').textContent = `Menampilkan ${pageItems.length} dari ${totalFiltered} item`;
            document.getElementById('igrmPaginationInfo').textContent = `Halaman ${igrmData.currentPage} dari ${totalPages || 1}`;
            
            // Update pagination buttons
            document.getElementById('igrmPrevBtn').disabled = igrmData.currentPage <= 1;
            document.getElementById('igrmNextBtn').disabled = igrmData.currentPage >= totalPages;
        }
        
        function formatDate(dateStr) {
            if (!dateStr) return '-';
            // Handle various date formats
            try {
                if (dateStr.includes('/')) {
                    const parts = dateStr.split('/');
                    if (parts.length === 3) {
                        return `${parts[0]}/${parts[1]}/${parts[2]}`;
                    }
                }
                return dateStr;
            } catch {
                return dateStr;
            }
        }
        
        function igrmPrevPage() {
            if (igrmData.currentPage > 1) {
                igrmData.currentPage--;
                renderIGRMTable();
            }
        }
        
        function igrmNextPage() {
            const totalPages = Math.ceil(igrmData.filteredItems.length / igrmData.itemsPerPage);
            if (igrmData.currentPage < totalPages) {
                igrmData.currentPage++;
                renderIGRMTable();
            }
        }

        // ==========================================
        // FUNGSI FETCH DATA DARI GOOGLE SHEETS
        // ==========================================
        
        async function fetchSheetData(sheetName, range) {
            const url = `https://sheets.googleapis.com/v4/spreadsheets/${SPREADSHEET_ID}/values/${encodeURIComponent(sheetName)}!${range}?key=${API_KEY}`;
            try {
                const response = await fetch(url);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const data = await response.json();
                return data.values || [];
            } catch (error) {
                console.error(`Error fetching ${sheetName}:`, error);
                return [];
            }
        }

        async function loadDataFromSheets() {
            showLoading(true);
            
            // Safety timeout - tutup loading setelah 30 detik
            const loadingTimeout = setTimeout(() => {
                showLoading(false);
                console.log('Loading timeout - closed after 30s');
            }, 30000);
            
            try {
                // 1. Fetch data artikel dari "Rekapan Box" (mulai baris 7)
                console.log('Fetching Rekapan Box...');
                const artikelData = await fetchSheetData(SHEET_REKAPAN, 'A7:J1000');
                console.log('Artikel data:', artikelData.length, 'rows');
                
                // 2. Fetch data transaksi dari "Transaksi" (mulai baris 6)
                console.log('Fetching Transaksi...');
                let transaksiData = [];
                try {
                    transaksiData = await fetchSheetData(SHEET_TRANSAKSI, 'A6:K500');
                    console.log('Transaksi data:', transaksiData.length, 'rows');
                } catch (e) {
                    console.log('Sheet Transaksi tidak ditemukan, skip...');
                }
                
                // Parse artikel data
                stockData.articles = [];
                let totalBoxDDD = 0;
                let totalBoxLJBB = 0;
                let totalPairs = 0;
                
                artikelData.forEach((row, index) => {
                    // Cek apakah ada data di kolom B (Kode Artikel)
                    if (row && row.length > 1 && row[1] && row[1].toString().trim() !== '') {
                        const kode = row[1].toString().trim();
                        
                        // Skip jika bukan kode artikel (header atau label)
                        if (kode.toLowerCase().includes('kode') || kode.toLowerCase().includes('artikel')) {
                            return;
                        }
                        
                        // Helper function untuk parse angka format Indonesia (4.121 = 4121)
                        const parseIndonesianNumber = (val) => {
                            if (!val) return 0;
                            // Hapus titik pemisah ribuan, ganti koma dengan titik untuk desimal
                            const str = val.toString().replace(/\./g, '').replace(',', '.');
                            const num = parseFloat(str) || 0;
                            return Math.round(num);
                        };
                        
                        const nama = row[2] ? row[2].toString() : '';
                        const tier = parseInt(row[3]) || 1;
                        const boxDDD = parseIndonesianNumber(row[4]);
                        const boxLJBB = parseIndonesianNumber(row[5]);
                        const total = parseIndonesianNumber(row[6]) || (boxDDD + boxLJBB);
                        const pairs = parseIndonesianNumber(row[7]) || (total * 12);
                        
                        stockData.articles.push({
                            no: stockData.articles.length + 1,
                            kode: kode,
                            nama: nama,
                            tier: tier,
                            boxDDD: boxDDD,
                            boxLJBB: boxLJBB,
                            total: total,
                            pairs: pairs
                        });
                        
                        totalBoxDDD += boxDDD;
                        totalBoxLJBB += boxLJBB;
                        totalPairs += pairs;
                    }
                });
                
                console.log('Parsed articles:', stockData.articles.length);
                
                // Update summary
                stockData.summary.boxDDD = totalBoxDDD;
                stockData.summary.boxLJBB = totalBoxLJBB;
                stockData.summary.totalBox = totalBoxDDD + totalBoxLJBB;
                stockData.summary.totalPairs = totalPairs;
                stockData.summary.totalArtikel = stockData.articles.length;
                
                // Calculate utilization (capacity = 10000 box)
                stockData.summary.capacity = MAX_CAPACITY;
                stockData.summary.utilization = (stockData.summary.totalBox / MAX_CAPACITY * 100);
                
                // Parse transaksi data (jika ada)
                stockData.transaksiIn = [];
                stockData.transaksiOut = [];
                let todayIn = 0, todayOut = 0;
                let weekIn = 0, weekOut = 0;
                let monthIn = 0, monthOut = 0;
                
                const today = new Date();
                const weekAgo = new Date(today.getTime() - 7 * 24 * 60 * 60 * 1000);
                const monthStart = new Date(today.getFullYear(), today.getMonth(), 1);
                
                transaksiData.forEach((row, index) => {
                    if (row && row.length > 5 && row[1]) {
                        const tanggalStr = row[1].toString();
                        const kode = row[2] ? row[2].toString() : '';
                        const nama = row[3] ? row[3].toString() : '';
                        const qtyIn = parseInt(row[4]) || 0;
                        const qtyOut = parseInt(row[5]) || 0;
                        const gudangAsal = row[6] ? row[6].toString() : '';
                        const gudangTerima = row[7] ? row[7].toString() : '';
                        
                        // Skip header rows
                        if (tanggalStr.toLowerCase().includes('tanggal') || kode.toLowerCase().includes('kode')) {
                            return;
                        }
                        
                        // Parse tanggal
                        let tanggalDate = null;
                        let tanggalDisplay = tanggalStr;
                        
                        if (tanggalStr.includes('/')) {
                            const parts = tanggalStr.split('/');
                            if (parts.length >= 3) {
                                const day = parseInt(parts[0]);
                                const month = parseInt(parts[1]) - 1;
                                const year = parts[2].length === 2 ? 2000 + parseInt(parts[2]) : parseInt(parts[2]);
                                tanggalDate = new Date(year, month, day);
                                tanggalDisplay = tanggalDate.toISOString().split('T')[0];
                            }
                        }
                        
                        if (qtyIn > 0) {
                            stockData.transaksiIn.push({
                                tanggal: tanggalDisplay,
                                kode: kode,
                                nama: nama,
                                tier: 1,
                                qty: qtyIn,
                                pairs: qtyIn * 12,
                                sumber: gudangAsal || 'Transfer'
                            });
                            
                            if (tanggalDate) {
                                if (tanggalDate.toDateString() === today.toDateString()) todayIn += qtyIn;
                                if (tanggalDate >= weekAgo) weekIn += qtyIn;
                                if (tanggalDate >= monthStart) monthIn += qtyIn;
                            }
                        }
                        
                        if (qtyOut > 0) {
                            stockData.transaksiOut.push({
                                tanggal: tanggalDisplay,
                                kode: kode,
                                nama: nama,
                                tier: 1,
                                qty: qtyOut,
                                pairs: qtyOut * 12,
                                tujuan: gudangTerima || 'Transfer'
                            });
                            
                            if (tanggalDate) {
                                if (tanggalDate.toDateString() === today.toDateString()) todayOut += qtyOut;
                                if (tanggalDate >= weekAgo) weekOut += qtyOut;
                                if (tanggalDate >= monthStart) monthOut += qtyOut;
                            }
                        }
                    }
                });
                
                // Update mutasi summary
                stockData.mutasi = {
                    todayIn: todayIn,
                    todayOut: todayOut,
                    weekIn: weekIn,
                    weekOut: weekOut,
                    monthIn: monthIn,
                    monthOut: monthOut
                };
                
                // Calculate tier breakdown
                calculateTierBreakdown();
                
                // Update dashboard
                updateDashboard();
                
                // Show last update time
                updateLastRefresh();
                
                console.log('Data loaded successfully!', stockData);
                
            } catch (error) {
                console.error('Error loading data:', error);
                // Tetap update dashboard dengan data yang ada
                updateDashboard();
                updateLastRefresh();
            } finally {
                // Clear timeout dan tutup loading
                clearTimeout(loadingTimeout);
                showLoading(false);
            }
        }
        
        function calculateTierBreakdown() {
            const tierMap = {};
            
            stockData.articles.forEach(article => {
                const tier = article.tier || 1; // Default to tier 1 if not set
                if (!tierMap[tier]) {
                    tierMap[tier] = { tier: tier, artikel: 0, box: 0, pairs: 0 };
                }
                tierMap[tier].artikel++;
                tierMap[tier].box += (article.total || 0);
                tierMap[tier].pairs += (article.pairs || 0);
            });
            
            const totalBox = stockData.summary.totalBox || 1;
            stockData.tierBreakdown = Object.values(tierMap).map(t => ({
                ...t,
                percent: Math.round((t.box / totalBox) * 100)
            })).sort((a, b) => a.tier - b.tier);
            
            console.log('Tier breakdown calculated:', stockData.tierBreakdown);
        }
        
        function showLoading(show) {
            const loader = document.getElementById('loadingOverlay');
            if (loader) {
                loader.style.display = show ? 'flex' : 'none';
            }
        }
        
        function updateLastRefresh() {
            const now = new Date();
            const timeStr = now.toLocaleString('id-ID', { 
                day: '2-digit', 
                month: 'short', 
                year: 'numeric',
                hour: '2-digit', 
                minute: '2-digit' 
            });
            const lastUpdateEl = document.getElementById('lastUpdate');
            if (lastUpdateEl) {
                lastUpdateEl.textContent = `Terakhir update: ${timeStr}`;
            }
        }
        
        // Refresh data setiap 5 menit
        function startAutoRefresh() {
            setInterval(() => {
                loadDataFromSheets();
            }, 5 * 60 * 1000); // 5 menit
        }

        // Pagination
        let currentPage = 1;
        const itemsPerPage = 10;
        let filteredArticles = [];

        function refreshData() {
            loadDataFromSheets();
        }

        // ==========================================
        // UPDATE DASHBOARD
        // ==========================================
        function updateDashboard() {
            // Reset filtered articles
            filteredArticles = [...stockData.articles];
            currentPage = 1;

            // Safe number formatting
            const safeNumber = (val) => isNaN(val) ? 0 : val;
            const safeFormat = (val) => safeNumber(val).toLocaleString('id-ID');
            const safePercent = (val) => safeNumber(val).toFixed(2);

            // Update summary cards
            document.getElementById('totalBox').textContent = safeFormat(stockData.summary.totalBox);
            document.getElementById('dddLjbbBreakdown').textContent = `DDD: ${safeFormat(stockData.summary.boxDDD)} | LJBB: ${safeFormat(stockData.summary.boxLJBB)}`;
            document.getElementById('utilization').textContent = safePercent(stockData.summary.utilization) + '%';
            document.getElementById('totalPairs').textContent = safeFormat(stockData.summary.totalPairs);
            document.getElementById('totalArtikel').textContent = safeFormat(stockData.articles.length);

            // Update gauge
            const utilizationPercent = safeNumber(stockData.summary.utilization);
            const circumference = 251.2;
            const offset = circumference - (utilizationPercent / 100 * circumference);
            document.getElementById('gaugeCircle').setAttribute('stroke-dashoffset', offset);
            document.getElementById('gaugePercent').textContent = safePercent(utilizationPercent) + '%';
            document.getElementById('usedCapacity').textContent = safeFormat(stockData.summary.totalBox) + ' box';
            document.getElementById('availableCapacity').textContent = safeFormat(stockData.summary.capacity - stockData.summary.totalBox) + ' box';

            // Update tier table
            updateTierTable();

            // Update article table
            updateArticleTable();

            // Update activity list
            updateActivityList();

            // Update charts
            updateCharts();

            // Update mutasi IN/OUT
            updateMutasiTables();
            updateMutasiCharts();

            // Update last update time
            document.getElementById('lastUpdate').textContent = 'Update: ' + new Date().toLocaleTimeString('id-ID');
        }

        function updateTierTable() {
            const tbody = document.getElementById('tierTableBody');
            if (!tbody) {
                console.error('tierTableBody not found');
                return;
            }
            tbody.innerHTML = '';
            
            // Check if tier breakdown exists
            if (!stockData.tierBreakdown || stockData.tierBreakdown.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" class="text-center text-gray-400 py-4">Belum ada data tier</td></tr>';
                return;
            }

            // ZUMA color palette for tiers
            const colors = {
                1: { bg: 'background: #002A3A;', bar: 'background: #002A3A;' },
                2: { bg: 'background: #00E273;', bar: 'background: #00E273;' },
                3: { bg: 'background: #003d52;', bar: 'background: #003d52;' },
                4: { bg: 'background: #33e88f;', bar: 'background: #33e88f;' },
                5: { bg: 'background: #00c264;', bar: 'background: #00c264;' },
                8: { bg: 'background: #009664;', bar: 'background: #009664;' }
            };

            stockData.tierBreakdown.forEach(tier => {
                const row = document.createElement('tr');
                row.className = 'border-b border-gray-100 hover:bg-gray-50';
                const colorStyle = colors[tier.tier] || colors[1];
                const textColor = tier.tier === 2 || tier.tier === 4 ? 'color: #002A3A;' : 'color: white;';
                
                row.innerHTML = `
                    <td class="py-3 px-4">
                        <span onclick="openTierModal(${tier.tier})" class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium cursor-pointer hover:opacity-80 hover:scale-105 transition-all" style="${colorStyle.bg} ${textColor}" title="Klik untuk lihat detail artikel Tier ${tier.tier}">
                            Tier ${tier.tier} üìã
                        </span>
                    </td>
                    <td class="py-3 px-4 text-right text-gray-700">${tier.artikel.toLocaleString('id-ID')}</td>
                    <td class="py-3 px-4 text-right font-semibold" style="color: #002A3A;">${tier.box.toLocaleString('id-ID')}</td>
                    <td class="py-3 px-4 text-right text-gray-700">${tier.pairs.toLocaleString('id-ID')}</td>
                    <td class="py-3 px-4 text-right text-gray-700">${tier.percent}%</td>
                    <td class="py-3 px-4">
                        <div class="w-full bg-gray-200 rounded-full h-2">
                            <div class="h-2 rounded-full" style="${colorStyle.bar} width: ${tier.percent}%"></div>
                        </div>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function updateArticleTable() {
            const tbody = document.getElementById('artikelTableBody');
            tbody.innerHTML = '';

            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const pageArticles = filteredArticles.slice(startIndex, endIndex);

            // ZUMA tier colors
            const tierColors = {
                1: { bg: '#002A3A', text: 'white' },
                2: { bg: '#00E273', text: '#002A3A' },
                3: { bg: '#003d52', text: 'white' },
                4: { bg: '#33e88f', text: '#002A3A' },
                5: { bg: '#00c264', text: 'white' },
                8: { bg: '#009664', text: 'white' }
            };

            if (pageArticles.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="9" class="py-12 text-center">
                            <svg class="w-16 h-16 mx-auto mb-4 text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                            <p class="text-gray-500 font-medium">Tidak ada artikel ditemukan</p>
                            <p class="text-gray-400 text-sm mt-1">Coba ubah filter atau kata kunci pencarian</p>
                        </td>
                    </tr>
                `;
            } else {
                pageArticles.forEach((article, idx) => {
                    const row = document.createElement('tr');
                    row.className = article.total > 0 
                        ? 'border-b border-gray-100 hover:bg-green-50 transition-colors' 
                        : 'border-b border-gray-100 hover:bg-red-50 transition-colors bg-gray-50';
                    
                    const statusClass = article.total > 0 
                        ? 'background: rgba(0, 226, 115, 0.15); color: #00c264;' 
                        : 'background: rgba(239, 68, 68, 0.15); color: #dc2626;';
                    const statusText = article.total > 0 ? '‚úÖ Tersedia' : '‚ùå Habis';
                    
                    const tierColor = tierColors[article.tier] || tierColors[1];

                    row.innerHTML = `
                        <td class="py-3 px-4 text-gray-500 text-sm">${startIndex + idx + 1}</td>
                        <td class="py-3 px-4">
                            <span class="font-mono text-sm font-bold" style="color: #002A3A;">${article.kode}</span>
                        </td>
                        <td class="py-3 px-4 text-gray-700">${article.nama}</td>
                        <td class="py-3 px-4 text-center">
                            <span class="inline-flex items-center px-2.5 py-1 rounded-full text-xs font-semibold" style="background: ${tierColor.bg}; color: ${tierColor.text};">
                                T${article.tier}
                            </span>
                        </td>
                        <td class="py-3 px-4 text-right text-gray-700">${article.boxDDD.toLocaleString('id-ID')}</td>
                        <td class="py-3 px-4 text-right text-gray-700">${article.boxLJBB.toLocaleString('id-ID')}</td>
                        <td class="py-3 px-4 text-right font-bold" style="color: #002A3A;">${article.total.toLocaleString('id-ID')}</td>
                        <td class="py-3 px-4 text-right text-gray-700">${article.pairs.toLocaleString('id-ID')}</td>
                        <td class="py-3 px-4 text-center">
                            <span class="inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium" style="${statusClass}">
                                ${statusText}
                            </span>
                        </td>
                    `;
                    tbody.appendChild(row);
                });
            }

            // Update pagination info
            const totalPages = Math.ceil(filteredArticles.length / itemsPerPage) || 1;
            document.getElementById('tableInfo').textContent = 
                filteredArticles.length > 0 
                    ? `Menampilkan ${startIndex + 1}-${Math.min(endIndex, filteredArticles.length)} dari ${filteredArticles.length} artikel`
                    : 'Tidak ada artikel';
            document.getElementById('pageInfo').textContent = `Page ${currentPage} of ${totalPages}`;

            // Update quick stats
            updateQuickStats();
        }

        function updateQuickStats() {
            const totalArtikel = stockData.articles.length;
            const hasStock = stockData.articles.filter(a => a.total > 0).length;
            const noStock = stockData.articles.filter(a => a.total === 0).length;

            document.getElementById('quickTotalArtikel').textContent = totalArtikel.toLocaleString('id-ID');
            document.getElementById('quickHasStock').textContent = hasStock.toLocaleString('id-ID');
            document.getElementById('quickNoStock').textContent = noStock.toLocaleString('id-ID');
        }

        function updateActivityList() {
            const activityList = document.getElementById('activityList');
            if (!activityList) return;
            activityList.innerHTML = '';
            
            // Create activities from transaksi data if activities is empty
            if (!stockData.activities || stockData.activities.length === 0) {
                stockData.activities = [];
                
                // Add recent IN transactions
                stockData.transaksiIn.slice(0, 3).forEach(t => {
                    stockData.activities.push({
                        type: 'in',
                        action: 'Barang Masuk',
                        item: `${t.kode} - ${t.nama}`,
                        change: `+${t.qty} box`,
                        time: t.tanggal
                    });
                });
                
                // Add recent OUT transactions
                stockData.transaksiOut.slice(0, 3).forEach(t => {
                    stockData.activities.push({
                        type: 'out',
                        action: 'Barang Keluar',
                        item: `${t.kode} - ${t.nama}`,
                        change: `-${t.qty} box`,
                        time: t.tanggal
                    });
                });
                
                // Sort by time (if needed, newest first)
                // stockData.activities.sort((a, b) => new Date(b.time) - new Date(a.time));
            }
            
            // Show placeholder if no activities
            if (stockData.activities.length === 0) {
                activityList.innerHTML = '<p class="text-gray-400 text-sm text-center py-4">Belum ada aktivitas</p>';
                return;
            }

            stockData.activities.forEach(activity => {
                const iconClass = activity.type === 'in' ? 'text-green-500' : 
                                  activity.type === 'out' ? 'text-red-500' : 'text-blue-500';
                const bgClass = activity.type === 'in' ? 'bg-green-100' : 
                                activity.type === 'out' ? 'bg-red-100' : 'bg-blue-100';

                const div = document.createElement('div');
                div.className = 'flex items-center gap-3 p-3 rounded-lg bg-gray-50';
                div.innerHTML = `
                    <div class="w-10 h-10 rounded-full ${bgClass} flex items-center justify-center">
                        <svg class="w-5 h-5 ${iconClass}" fill="currentColor" viewBox="0 0 20 20">
                            ${activity.type === 'in' ? 
                                '<path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-8.707l-3-3a1 1 0 00-1.414 1.414L10.586 9H7a1 1 0 100 2h3.586l-1.293 1.293a1 1 0 101.414 1.414l3-3a1 1 0 000-1.414z" clip-rule="evenodd"></path>' :
                                activity.type === 'out' ?
                                '<path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm.707-10.293a1 1 0 00-1.414-1.414l-3 3a1 1 0 000 1.414l3 3a1 1 0 001.414-1.414L9.414 11H13a1 1 0 100-2H9.414l1.293-1.293z" clip-rule="evenodd"></path>' :
                                '<path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>'
                            }
                        </svg>
                    </div>
                    <div class="flex-1">
                        <p class="text-sm font-medium text-gray-800">${activity.action}</p>
                        <p class="text-xs text-gray-500">${activity.item}</p>
                    </div>
                    <div class="text-right">
                        <p class="text-sm font-semibold ${iconClass}">${activity.change}</p>
                        <p class="text-xs text-gray-400">${activity.time}</p>
                    </div>
                `;
                activityList.appendChild(div);
            });
        }

        function updateCharts() {
            console.log('updateCharts called');
            console.log('tierBreakdown:', stockData.tierBreakdown);
            console.log('boxDDD:', stockData.summary.boxDDD, 'boxLJBB:', stockData.summary.boxLJBB);
            
            // Skip if no data
            if (!stockData.tierBreakdown || stockData.tierBreakdown.length === 0) {
                console.log('No tier data, creating default');
                stockData.tierBreakdown = [
                    { tier: 1, artikel: stockData.articles.length, box: stockData.summary.totalBox, pairs: stockData.summary.totalPairs, percent: 100 }
                ];
            }
            
            // Destroy existing charts if they exist
            if (window.tierChartInstance) {
                window.tierChartInstance.destroy();
            }
            if (window.entityChartInstance) {
                window.entityChartInstance.destroy();
            }

            // Tier Distribution Chart - CLICKABLE
            const tierCtx = document.getElementById('tierChart');
            if (!tierCtx) {
                console.error('tierChart canvas not found');
                return;
            }
            
            window.tierChartInstance = new Chart(tierCtx.getContext('2d'), {
                type: 'bar',
                data: {
                    labels: stockData.tierBreakdown.map(t => 'Tier ' + t.tier),
                    datasets: [{
                        label: 'Total Box',
                        data: stockData.tierBreakdown.map(t => t.box),
                        backgroundColor: [
                            'rgba(0, 42, 58, 0.9)',      // Tier 1 - Zuma Dark
                            'rgba(0, 226, 115, 0.9)',   // Tier 2 - Zuma Green
                            'rgba(0, 61, 82, 0.9)',     // Tier 3 - Zuma Dark Light
                            'rgba(51, 232, 143, 0.9)',  // Tier 4 - Zuma Green Light
                            'rgba(0, 194, 100, 0.9)',   // Tier 5 - Zuma Green Dark
                            'rgba(0, 150, 100, 0.9)'    // Tier 8 - Custom teal
                        ],
                        borderRadius: 8,
                        borderSkipped: false,
                        // Store tier numbers for click handling
                        tierNumbers: stockData.tierBreakdown.map(t => t.tier)
                    }]
                },
                options: {
                    responsive: true,
                    onClick: (event, elements) => {
                        if (elements.length > 0) {
                            const index = elements[0].index;
                            const tierNumber = stockData.tierBreakdown[index].tier;
                            openTierModal(tierNumber);
                        }
                    },
                    onHover: (event, elements) => {
                        event.native.target.style.cursor = elements.length > 0 ? 'pointer' : 'default';
                    },
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                title: (context) => {
                                    const index = context[0].dataIndex;
                                    const tier = stockData.tierBreakdown[index];
                                    return `Tier ${tier.tier}`;
                                },
                                label: (context) => {
                                    const index = context.dataIndex;
                                    const tier = stockData.tierBreakdown[index];
                                    return [
                                        `Total Box: ${tier.box.toLocaleString('id-ID')}`,
                                        `Total Pairs: ${tier.pairs.toLocaleString('id-ID')}`,
                                        `Jumlah Artikel: ${tier.artikel}`,
                                        `Persentase: ${tier.percent}%`,
                                        '',
                                        'üëÜ Klik untuk lihat daftar artikel'
                                    ];
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: { color: 'rgba(0,0,0,0.05)' }
                        },
                        x: {
                            grid: { display: false }
                        }
                    }
                }
            });

            // Entity Chart
            const entityCtx = document.getElementById('entityChart');
            if (!entityCtx) {
                console.error('entityChart canvas not found');
                return;
            }
            
            window.entityChartInstance = new Chart(entityCtx.getContext('2d'), {
                type: 'doughnut',
                data: {
                    labels: ['DDD', 'LJBB'],
                    datasets: [{
                        data: [stockData.summary.boxDDD, stockData.summary.boxLJBB],
                        backgroundColor: [
                            'rgba(0, 42, 58, 0.9)',    // Zuma Dark
                            'rgba(0, 226, 115, 0.9)'  // Zuma Green
                        ],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    },
                    cutout: '60%'
                }
            });
        }

        // ==========================================
        // MUTASI IN/OUT FUNCTIONS
        // ==========================================
        let currentMutasiPeriod = 'today';
        let mutasiLineChartInstance = null;
        let mutasiBarChartInstance = null;

        function setMutasiPeriod(period) {
            currentMutasiPeriod = period;
            
            // Update button styles dengan warna ZUMA
            document.getElementById('btnToday').className = period === 'today' 
                ? 'px-4 py-2 text-white rounded-lg text-sm font-medium'
                : 'px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 text-sm font-medium';
            document.getElementById('btnToday').style.background = period === 'today' ? '#002A3A' : '';
            
            document.getElementById('btnWeek').className = period === 'week' 
                ? 'px-4 py-2 text-white rounded-lg text-sm font-medium'
                : 'px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 text-sm font-medium';
            document.getElementById('btnWeek').style.background = period === 'week' ? '#002A3A' : '';
            
            document.getElementById('btnMonth').className = period === 'month' 
                ? 'px-4 py-2 text-white rounded-lg text-sm font-medium'
                : 'px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 text-sm font-medium';
            document.getElementById('btnMonth').style.background = period === 'month' ? '#002A3A' : '';

            // Update values based on period
            let inValue, outValue;
            switch(period) {
                case 'today':
                    inValue = stockData.mutasi.todayIn;
                    outValue = stockData.mutasi.todayOut;
                    break;
                case 'week':
                    inValue = stockData.mutasi.weekIn;
                    outValue = stockData.mutasi.weekOut;
                    break;
                case 'month':
                    inValue = stockData.mutasi.monthIn;
                    outValue = stockData.mutasi.monthOut;
                    break;
            }

            const netValue = inValue - outValue;
            const totalTrans = inValue + outValue;

            document.getElementById('totalIn').textContent = inValue.toLocaleString('id-ID');
            document.getElementById('totalOut').textContent = outValue.toLocaleString('id-ID');
            document.getElementById('netMutasi').textContent = (netValue >= 0 ? '+' : '') + netValue.toLocaleString('id-ID');
            document.getElementById('totalTransaksi').textContent = totalTrans.toLocaleString('id-ID');

            // Update net color
            const netElement = document.getElementById('netMutasi');
            if (netValue >= 0) {
                netElement.className = 'text-3xl font-bold text-green-700 mt-1';
            } else {
                netElement.className = 'text-3xl font-bold text-red-700 mt-1';
            }

            // Update bar chart
            updateMutasiBarChart(inValue, outValue);
        }

        let currentMutasiTab = 'in';
        let filteredTransaksiIn = [];
        let filteredTransaksiOut = [];

        function showMutasiTab(tab) {
            currentMutasiTab = tab;
            if (tab === 'in') {
                document.getElementById('tableIn').classList.remove('hidden');
                document.getElementById('tableOut').classList.add('hidden');
                document.getElementById('tabIn').className = 'px-4 py-2 border-b-2 border-green-500 text-green-600 font-medium text-sm flex items-center gap-2';
                document.getElementById('tabOut').className = 'px-4 py-2 border-b-2 border-transparent text-gray-500 hover:text-gray-700 font-medium text-sm flex items-center gap-2';
            } else {
                document.getElementById('tableIn').classList.add('hidden');
                document.getElementById('tableOut').classList.remove('hidden');
                document.getElementById('tabIn').className = 'px-4 py-2 border-b-2 border-transparent text-gray-500 hover:text-gray-700 font-medium text-sm flex items-center gap-2';
                document.getElementById('tabOut').className = 'px-4 py-2 border-b-2 border-red-500 text-red-600 font-medium text-sm flex items-center gap-2';
            }
            // Re-apply filter when switching tabs
            filterMutasiTable();
        }

        function filterMutasiTable() {
            const searchTerm = document.getElementById('searchMutasi').value.toLowerCase().trim();
            const sumberTujuanFilter = document.getElementById('filterSumberTujuan').value.toLowerCase();

            // Filter IN
            filteredTransaksiIn = stockData.transaksiIn.filter(trx => {
                const kode = trx.kode.toLowerCase();
                const nama = trx.nama.toLowerCase();
                const sumber = trx.sumber.toLowerCase();
                
                const matchesSearch = !searchTerm || kode.includes(searchTerm) || nama.includes(searchTerm);
                const matchesSumber = !sumberTujuanFilter || sumber.includes(sumberTujuanFilter);
                
                return matchesSearch && matchesSumber;
            });

            // Filter OUT
            filteredTransaksiOut = stockData.transaksiOut.filter(trx => {
                const kode = trx.kode.toLowerCase();
                const nama = trx.nama.toLowerCase();
                const tujuan = trx.tujuan.toLowerCase();
                
                const matchesSearch = !searchTerm || kode.includes(searchTerm) || nama.includes(searchTerm);
                const matchesTujuan = !sumberTujuanFilter || tujuan.includes(sumberTujuanFilter);
                
                return matchesSearch && matchesTujuan;
            });

            // Update counts
            document.getElementById('countIn').textContent = filteredTransaksiIn.length;
            document.getElementById('countOut').textContent = filteredTransaksiOut.length;

            // Update filter info
            const filterInfo = document.getElementById('mutasiFilterInfo');
            const activeFilters = [];
            if (searchTerm) activeFilters.push(`üîç "${searchTerm}"`);
            if (sumberTujuanFilter) activeFilters.push(`üìç ${sumberTujuanFilter}`);
            
            if (activeFilters.length > 0) {
                const currentCount = currentMutasiTab === 'in' ? filteredTransaksiIn.length : filteredTransaksiOut.length;
                filterInfo.innerHTML = `
                    <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M3 3a1 1 0 011-1h12a1 1 0 011 1v3a1 1 0 01-.293.707L12 11.414V15a1 1 0 01-.293.707l-2 2A1 1 0 018 17v-5.586L3.293 6.707A1 1 0 013 6V3z" clip-rule="evenodd"></path>
                    </svg>
                    ${activeFilters.join(' ‚Ä¢ ')} ‚Äî <strong>${currentCount}</strong> transaksi ditemukan
                `;
                filterInfo.classList.remove('hidden');
                filterInfo.classList.add('inline-flex');
            } else {
                filterInfo.classList.add('hidden');
                filterInfo.classList.remove('inline-flex');
            }

            // Update tables
            updateMutasiTables();
        }

        function resetMutasiFilter() {
            document.getElementById('searchMutasi').value = '';
            document.getElementById('filterSumberTujuan').value = '';
            filterMutasiTable();
        }

        function updateMutasiTables() {
            // Use filtered data or all data if no filter applied
            const dataIn = filteredTransaksiIn.length > 0 || document.getElementById('searchMutasi').value || document.getElementById('filterSumberTujuan').value 
                ? filteredTransaksiIn 
                : stockData.transaksiIn;
            const dataOut = filteredTransaksiOut.length > 0 || document.getElementById('searchMutasi').value || document.getElementById('filterSumberTujuan').value 
                ? filteredTransaksiOut 
                : stockData.transaksiOut;

            // Update table IN
            const tbodyIn = document.getElementById('tableInBody');
            tbodyIn.innerHTML = '';
            
            if (dataIn.length === 0) {
                tbodyIn.innerHTML = `
                    <tr>
                        <td colspan="7" class="py-8 text-center">
                            <svg class="w-12 h-12 mx-auto mb-2 text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                            <p class="text-gray-500">Tidak ada transaksi masuk ditemukan</p>
                        </td>
                    </tr>
                `;
            } else {
                dataIn.forEach(trx => {
                    const row = document.createElement('tr');
                    row.className = 'border-b border-gray-100 hover:bg-green-50 transition-colors';
                    row.innerHTML = `
                        <td class="py-3 px-4 text-gray-600">${trx.tanggal}</td>
                        <td class="py-3 px-4 font-mono text-sm font-bold" style="color: #002A3A;">${trx.kode}</td>
                        <td class="py-3 px-4 text-gray-700">${trx.nama}</td>
                        <td class="py-3 px-4 text-center">
                            <span class="inline-flex items-center px-2.5 py-1 rounded-full text-xs font-semibold" style="background: rgba(0, 226, 115, 0.15); color: #00c264;">T${trx.tier}</span>
                        </td>
                        <td class="py-3 px-4 text-right font-bold text-green-600">+${trx.qty}</td>
                        <td class="py-3 px-4 text-right text-gray-700">${trx.pairs.toLocaleString('id-ID')}</td>
                        <td class="py-3 px-4">
                            <span class="inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium" style="background: rgba(0, 42, 58, 0.1); color: #002A3A;">${getSumberIcon(trx.sumber)} ${trx.sumber}</span>
                        </td>
                    `;
                    tbodyIn.appendChild(row);
                });
            }

            // Update table OUT
            const tbodyOut = document.getElementById('tableOutBody');
            tbodyOut.innerHTML = '';
            
            if (dataOut.length === 0) {
                tbodyOut.innerHTML = `
                    <tr>
                        <td colspan="7" class="py-8 text-center">
                            <svg class="w-12 h-12 mx-auto mb-2 text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                            <p class="text-gray-500">Tidak ada transaksi keluar ditemukan</p>
                        </td>
                    </tr>
                `;
            } else {
                dataOut.forEach(trx => {
                    const row = document.createElement('tr');
                    row.className = 'border-b border-gray-100 hover:bg-red-50 transition-colors';
                    row.innerHTML = `
                        <td class="py-3 px-4 text-gray-600">${trx.tanggal}</td>
                        <td class="py-3 px-4 font-mono text-sm font-bold" style="color: #002A3A;">${trx.kode}</td>
                        <td class="py-3 px-4 text-gray-700">${trx.nama}</td>
                        <td class="py-3 px-4 text-center">
                            <span class="inline-flex items-center px-2.5 py-1 rounded-full text-xs font-semibold" style="background: rgba(239, 68, 68, 0.15); color: #dc2626;">T${trx.tier}</span>
                        </td>
                        <td class="py-3 px-4 text-right font-bold text-red-600">-${trx.qty}</td>
                        <td class="py-3 px-4 text-right text-gray-700">${trx.pairs.toLocaleString('id-ID')}</td>
                        <td class="py-3 px-4">
                            <span class="inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium" style="background: rgba(239, 68, 68, 0.1); color: #dc2626;">${getTujuanIcon(trx.tujuan)} ${trx.tujuan}</span>
                        </td>
                    `;
                    tbodyOut.appendChild(row);
                });
            }

            // Update counts on initial load
            document.getElementById('countIn').textContent = dataIn.length;
            document.getElementById('countOut').textContent = dataOut.length;
        }

        function getSumberIcon(sumber) {
            const icons = {
                'Produksi': 'üì¶',
                'Retur': 'üîÑ',
                'Transfer': 'üöö'
            };
            return icons[sumber] || 'üìã';
        }

        function getTujuanIcon(tujuan) {
            if (tujuan.includes('Store')) return 'üè™';
            if (tujuan.includes('Online')) return 'üåê';
            return 'üìã';
        }

        function updateMutasiCharts() {
            console.log('updateMutasiCharts called');
            console.log('dailyMutasi:', stockData.dailyMutasi);
            
            // Create default daily mutasi if empty (last 7 days)
            if (!stockData.dailyMutasi || stockData.dailyMutasi.length === 0) {
                const today = new Date();
                stockData.dailyMutasi = [];
                for (let i = 6; i >= 0; i--) {
                    const date = new Date(today);
                    date.setDate(date.getDate() - i);
                    const dateStr = date.toLocaleDateString('id-ID', { day: '2-digit', month: 'short' });
                    stockData.dailyMutasi.push({
                        tanggal: dateStr,
                        in: 0,
                        out: 0
                    });
                }
            }
            
            // Line Chart - Trend
            const lineCtx = document.getElementById('mutasiLineChart');
            if (!lineCtx) {
                console.error('mutasiLineChart canvas not found');
                return;
            }
            
            if (mutasiLineChartInstance) {
                mutasiLineChartInstance.destroy();
            }
            mutasiLineChartInstance = new Chart(lineCtx.getContext('2d'), {
                type: 'line',
                data: {
                    labels: stockData.dailyMutasi.map(d => d.tanggal),
                    datasets: [
                        {
                            label: 'Barang Masuk',
                            data: stockData.dailyMutasi.map(d => d.in),
                            borderColor: '#00E273',
                            backgroundColor: 'rgba(0, 226, 115, 0.1)',
                            fill: true,
                            tension: 0.4,
                            pointBackgroundColor: '#00E273',
                            pointRadius: 4
                        },
                        {
                            label: 'Barang Keluar',
                            data: stockData.dailyMutasi.map(d => d.out),
                            borderColor: '#002A3A',
                            backgroundColor: 'rgba(0, 42, 58, 0.1)',
                            fill: true,
                            tension: 0.4,
                            pointBackgroundColor: '#002A3A',
                            pointRadius: 4
                        }
                    ]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: { usePointStyle: true }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: { color: 'rgba(0,0,0,0.05)' }
                        },
                        x: {
                            grid: { display: false }
                        }
                    }
                }
            });

            // Bar Chart - Comparison
            updateMutasiBarChart(stockData.mutasi.todayIn, stockData.mutasi.todayOut);
        }

        function updateMutasiBarChart(inValue, outValue) {
            const barCtx = document.getElementById('mutasiBarChart').getContext('2d');
            if (mutasiBarChartInstance) {
                mutasiBarChartInstance.destroy();
            }
            mutasiBarChartInstance = new Chart(barCtx, {
                type: 'bar',
                data: {
                    labels: ['Barang Masuk', 'Barang Keluar'],
                    datasets: [{
                        label: 'Jumlah Box',
                        data: [inValue, outValue],
                        backgroundColor: [
                            'rgba(0, 226, 115, 0.9)',  // Zuma Green untuk IN
                            'rgba(0, 42, 58, 0.9)'    // Zuma Dark untuk OUT
                        ],
                        borderRadius: 8,
                        borderSkipped: false,
                    }]
                },
                options: {
                    responsive: true,
                    indexAxis: 'y',
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: (context) => `${context.raw.toLocaleString('id-ID')} Box`
                            }
                        }
                    },
                    scales: {
                        x: {
                            beginAtZero: true,
                            grid: { color: 'rgba(0,0,0,0.05)' }
                        },
                        y: {
                            grid: { display: false }
                        }
                    }
                }
            });
        }

        // ==========================================
        // MODAL FUNCTIONS
        // ==========================================
        let currentModalTier = null;
        let modalFilteredArticles = [];
        let currentStockFilter = 'all'; // 'all', 'hasStock', 'noStock'

        function openTierModal(tierNumber) {
            currentModalTier = tierNumber;
            currentStockFilter = 'all'; // Reset filter when opening modal
            const tierData = stockData.tierBreakdown.find(t => t.tier === tierNumber);
            const tierArticles = stockData.articles.filter(a => a.tier === tierNumber);
            modalFilteredArticles = [...tierArticles];

            // Warna berdasarkan tier - ZUMA theme
            const colors = {
                1: { bg: '#002A3A', light: 'rgba(0, 42, 58, 0.1)', text: '#002A3A', textLight: '#003d52', textOnBg: 'white' },
                2: { bg: '#00E273', light: 'rgba(0, 226, 115, 0.1)', text: '#00c264', textLight: '#00E273', textOnBg: '#002A3A' },
                3: { bg: '#003d52', light: 'rgba(0, 61, 82, 0.1)', text: '#003d52', textLight: '#004d66', textOnBg: 'white' },
                4: { bg: '#33e88f', light: 'rgba(51, 232, 143, 0.1)', text: '#00c264', textLight: '#33e88f', textOnBg: '#002A3A' },
                5: { bg: '#00c264', light: 'rgba(0, 194, 100, 0.1)', text: '#00c264', textLight: '#00d670', textOnBg: 'white' },
                8: { bg: '#009664', light: 'rgba(0, 150, 100, 0.1)', text: '#009664', textLight: '#00a872', textOnBg: 'white' }
            };
            const color = colors[tierNumber] || colors[1];

            // Update modal header
            document.getElementById('modalTitle').innerHTML = `
                <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium mr-2" style="background: ${color.bg}; color: ${color.textOnBg};">
                    Tier ${tierNumber}
                </span>
                Detail Artikel
            `;
            document.getElementById('modalSubtitle').textContent = 
                `Total: ${tierData.box.toLocaleString('id-ID')} Box | ${tierData.pairs.toLocaleString('id-ID')} Pairs | ${tierData.artikel} Artikel`;

            // Update summary cards
            document.getElementById('modalBoxCard').innerHTML = `
                <p class="text-2xl font-bold" style="color: ${color.text};">${tierData.box.toLocaleString('id-ID')}</p>
                <p class="text-sm" style="color: ${color.textLight};">Total Box</p>
            `;
            document.getElementById('modalBoxCard').style.background = color.light;
            document.getElementById('modalBoxCard').className = 'rounded-lg p-4 text-center';

            document.getElementById('modalPairsCard').innerHTML = `
                <p class="text-2xl font-bold" style="color: ${color.text};">${tierData.pairs.toLocaleString('id-ID')}</p>
                <p class="text-sm" style="color: ${color.textLight};">Total Pairs</p>
            `;
            document.getElementById('modalPairsCard').style.background = color.light;
            document.getElementById('modalPairsCard').className = 'rounded-lg p-4 text-center';

            document.getElementById('modalArtikelCard').innerHTML = `
                <p class="text-2xl font-bold" style="color: ${color.text};">${tierArticles.length}</p>
                <p class="text-sm" style="color: ${color.textLight};">Jumlah Artikel</p>
            `;
            document.getElementById('modalArtikelCard').style.background = color.light;
            document.getElementById('modalArtikelCard').className = 'rounded-lg p-4 text-center';

            // Clear search
            document.getElementById('modalSearch').value = '';
            
            // Reset filter buttons
            resetFilterButtons();

            // Populate table
            updateModalTable();

            // Show modal
            const modal = document.getElementById('tierModal');
            modal.classList.remove('hidden');
            modal.classList.add('flex');
            
            // Prevent body scroll
            document.body.style.overflow = 'hidden';
        }

        function closeModal() {
            const modal = document.getElementById('tierModal');
            modal.classList.add('hidden');
            modal.classList.remove('flex');
            document.body.style.overflow = 'auto';
            currentModalTier = null;
        }

        function filterModalTable() {
            const searchTerm = document.getElementById('modalSearch').value.toLowerCase().trim();
            const tierArticles = stockData.articles.filter(a => a.tier === currentModalTier);

            modalFilteredArticles = tierArticles.filter(article => {
                // Search filter
                const kode = article.kode.toLowerCase();
                const nama = article.nama.toLowerCase();
                const matchesSearch = !searchTerm || kode.includes(searchTerm) || nama.includes(searchTerm);
                
                // Stock filter
                let matchesStock = true;
                if (currentStockFilter === 'hasStock') {
                    matchesStock = article.total > 0;
                } else if (currentStockFilter === 'noStock') {
                    matchesStock = article.total === 0;
                }
                
                return matchesSearch && matchesStock;
            });

            updateModalTable();
        }
        
        function setModalFilter(filter) {
            currentStockFilter = filter;
            
            // Update button styles
            const btnAll = document.getElementById('filterAll');
            const btnHasStock = document.getElementById('filterHasStock');
            const btnNoStock = document.getElementById('filterNoStock');
            
            // Reset all buttons
            [btnAll, btnHasStock, btnNoStock].forEach(btn => {
                btn.className = 'px-4 py-2 text-sm font-medium rounded-lg transition-colors bg-gray-100 text-gray-700 hover:bg-gray-200';
                btn.style.background = '';
            });
            
            // Highlight active button
            const activeBtn = filter === 'all' ? btnAll : (filter === 'hasStock' ? btnHasStock : btnNoStock);
            activeBtn.className = 'px-4 py-2 text-sm font-medium rounded-lg transition-colors text-white';
            activeBtn.style.background = '#002A3A';
            
            // Apply filter
            filterModalTable();
        }
        
        function resetFilterButtons() {
            currentStockFilter = 'all';
            const btnAll = document.getElementById('filterAll');
            const btnHasStock = document.getElementById('filterHasStock');
            const btnNoStock = document.getElementById('filterNoStock');
            
            if (btnAll) {
                btnAll.className = 'px-4 py-2 text-sm font-medium rounded-lg transition-colors text-white';
                btnAll.style.background = '#002A3A';
            }
            if (btnHasStock) {
                btnHasStock.className = 'px-4 py-2 text-sm font-medium rounded-lg transition-colors bg-gray-100 text-gray-700 hover:bg-gray-200';
                btnHasStock.style.background = '';
            }
            if (btnNoStock) {
                btnNoStock.className = 'px-4 py-2 text-sm font-medium rounded-lg transition-colors bg-gray-100 text-gray-700 hover:bg-gray-200';
                btnNoStock.style.background = '';
            }
        }

        function updateModalTable() {
            const tbody = document.getElementById('modalTableBody');
            tbody.innerHTML = '';

            if (modalFilteredArticles.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="8" class="py-8 text-center text-gray-500">
                            <svg class="w-12 h-12 mx-auto mb-2 text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                            Tidak ada artikel ditemukan
                        </td>
                    </tr>
                `;
                document.getElementById('modalTableInfo').textContent = 'Menampilkan 0 artikel';
                return;
            }

            modalFilteredArticles.forEach((article, index) => {
                const row = document.createElement('tr');
                row.className = 'border-b border-gray-100 hover:bg-gray-50';
                
                const statusClass = article.total > 0 
                    ? 'bg-green-100 text-green-800' 
                    : 'bg-red-100 text-red-800';
                const statusText = article.total > 0 ? 'Tersedia' : 'Habis';

                row.innerHTML = `
                    <td class="py-3 px-4 text-gray-600">${index + 1}</td>
                    <td class="py-3 px-4 font-mono text-sm font-semibold text-blue-600">${article.kode}</td>
                    <td class="py-3 px-4 text-gray-700">${article.nama}</td>
                    <td class="py-3 px-4 text-right text-gray-700">${article.boxDDD}</td>
                    <td class="py-3 px-4 text-right text-gray-700">${article.boxLJBB}</td>
                    <td class="py-3 px-4 text-right font-semibold text-gray-800">${article.total}</td>
                    <td class="py-3 px-4 text-right text-gray-700">${article.pairs}</td>
                    <td class="py-3 px-4 text-center">
                        <span class="inline-flex items-center px-2 py-1 rounded text-xs font-medium ${statusClass}">
                            ${statusText}
                        </span>
                    </td>
                `;
                tbody.appendChild(row);
            });

            // Count items with/without stock
            const tierArticles = stockData.articles.filter(a => a.tier === currentModalTier);
            const hasStockCount = tierArticles.filter(a => a.total > 0).length;
            const noStockCount = tierArticles.filter(a => a.total === 0).length;
            
            let filterText = '';
            if (currentStockFilter === 'hasStock') {
                filterText = ` (Ada Stok: ${hasStockCount})`;
            } else if (currentStockFilter === 'noStock') {
                filterText = ` (Habis: ${noStockCount})`;
            } else {
                filterText = ` (Ada Stok: ${hasStockCount} | Habis: ${noStockCount})`;
            }
            
            document.getElementById('modalTableInfo').textContent = `Menampilkan ${modalFilteredArticles.length} artikel${filterText}`;
        }

        // Close modal when clicking outside
        document.getElementById('tierModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeModal();
            }
        });

        // Close modal with Escape key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeModal();
            }
        });

        // ==========================================
        // FILTER & PAGINATION
        // ==========================================
        
        // Fungsi untuk filter by tier dari klik badge
        function filterByTier(tierNumber) {
            // Set dropdown filter
            document.getElementById('tierFilter').value = tierNumber.toString();
            // Clear search dan stock filter
            document.getElementById('searchInput').value = '';
            document.getElementById('stockFilter').value = '';
            // Jalankan filter
            filterTable();
            // Scroll ke section artikel dengan smooth animation
            document.getElementById('artikelSection').scrollIntoView({ 
                behavior: 'smooth',
                block: 'start'
            });
            // Highlight section dengan warna ZUMA
            const section = document.getElementById('artikelSection');
            section.style.boxShadow = '0 0 0 3px #00E273';
            setTimeout(() => {
                section.style.boxShadow = '';
            }, 2000);
        }

        // Fungsi reset semua filter
        function resetFilters() {
            document.getElementById('searchInput').value = '';
            document.getElementById('tierFilter').value = '';
            document.getElementById('stockFilter').value = '';
            filterTable();
        }

        function filterTable() {
            // Ambil value dan convert ke lowercase untuk case-insensitive search
            const searchTerm = document.getElementById('searchInput').value.toLowerCase().trim();
            const tierFilter = document.getElementById('tierFilter').value;
            const stockFilter = document.getElementById('stockFilter').value;

            filteredArticles = stockData.articles.filter(article => {
                // Case-insensitive search - semua diconvert ke lowercase
                const kode = article.kode.toLowerCase();
                const nama = article.nama.toLowerCase();
                
                // Cek apakah search term ada di kode ATAU nama (case-insensitive)
                const matchesSearch = !searchTerm || 
                                     kode.includes(searchTerm) || 
                                     nama.includes(searchTerm);
                
                // Filter tier
                const matchesTier = !tierFilter || article.tier.toString() === tierFilter;
                
                // Filter stok
                const matchesStock = !stockFilter || 
                                    (stockFilter === 'hasStock' && article.total > 0) ||
                                    (stockFilter === 'noStock' && article.total === 0);
                
                return matchesSearch && matchesTier && matchesStock;
            });

            // Update active filter info dengan ZUMA styling
            const filterInfo = document.getElementById('activeFilterInfo');
            const activeFilters = [];
            if (tierFilter) activeFilters.push(`üè∑Ô∏è Tier ${tierFilter}`);
            if (stockFilter === 'hasStock') activeFilters.push('‚úÖ Ada Stok');
            if (stockFilter === 'noStock') activeFilters.push('‚ùå Stok Habis');
            if (searchTerm) activeFilters.push(`üîç "${searchTerm}"`);
            
            if (activeFilters.length > 0) {
                filterInfo.innerHTML = `
                    <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M3 3a1 1 0 011-1h12a1 1 0 011 1v3a1 1 0 01-.293.707L12 11.414V15a1 1 0 01-.293.707l-2 2A1 1 0 018 17v-5.586L3.293 6.707A1 1 0 013 6V3z" clip-rule="evenodd"></path>
                    </svg>
                    ${activeFilters.join(' ‚Ä¢ ')} ‚Äî <strong>${filteredArticles.length}</strong> artikel ditemukan
                `;
                filterInfo.classList.remove('hidden');
                filterInfo.classList.add('inline-flex');
            } else {
                filterInfo.classList.add('hidden');
                filterInfo.classList.remove('inline-flex');
            }

            currentPage = 1;
            updateArticleTable();
        }

        function prevPage() {
            if (currentPage > 1) {
                currentPage--;
                updateArticleTable();
            }
        }

        function nextPage() {
            const maxPage = Math.ceil(filteredArticles.length / itemsPerPage);
            if (currentPage < maxPage) {
                currentPage++;
                updateArticleTable();
            }
        }

        // ==========================================
        // INIT
        // ==========================================
        document.addEventListener('DOMContentLoaded', () => {
            // Load data dari Google Sheets
            loadDataFromSheets();
            
            // Auto refresh setiap 5 menit
            startAutoRefresh();
        });
    </script>
</body>
</html>
